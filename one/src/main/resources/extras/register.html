<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Functional Signup Form</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Icons Library -->
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-blue': '#3b82f6',
                    },
                }
            }
        }

        // Custom Message Box function (replacing alert())
        const showMessageBox = (message, color) => {
            const messageBox = document.getElementById('message-box');
            messageBox.textContent = message;

            // Clear existing color classes
            messageBox.classList.remove('bg-red-500', 'bg-green-500', 'hidden');

            if (color === 'red') {
                messageBox.classList.add('bg-red-500');
            } else if (color === 'green') {
                messageBox.classList.add('bg-green-500');
            }

            messageBox.classList.remove('opacity-0');
            messageBox.classList.add('opacity-100');

            setTimeout(() => {
                messageBox.classList.remove('opacity-100');
                messageBox.classList.add('opacity-0');
                // Hide message after transition
                setTimeout(() => messageBox.classList.add('hidden'), 500);
            }, 3000);
        }

        // Function to handle the form submission (Refactored from user's code)
        window.handleSignup = (event) => {
            event.preventDefault(); // Stop default form submission

            const submitButton = document.getElementById("submit");
            const username = document.getElementById('username').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('passwordcon').value;

            if (password !== confirmPassword) {
                showMessageBox("Error: Passwords do not match!", 'red');
                return;
            }

            if (username.trim() === "" || email.trim() === "" || password.trim() === "") {
                showMessageBox("Please fill in all required fields.", 'red');
                return;
            }

            const data ={
                username,
                email,
                password
            };
            const jsonData = JSON.stringify(data);

            // UI Feedback during submission
            submitButton.textContent = 'Signing up...';
            submitButton.disabled = true;

            // Simulating a network request (Original user logic kept)
            fetch('/req/signup', {
                method: 'POST',
                headers:{
                    'Content-Type': 'application/json'
                },
                body: jsonData
            })
                .then(response => {
                    submitButton.textContent = 'Sign Up';
                    submitButton.disabled = false;

                    if(response.ok){ // Check if status is 200-299
                        showMessageBox('Signup successful (simulated)! Proceed to Login.', 'green');
                        document.getElementById('signup-form').reset();
                    } else {
                        // Handle non-OK responses (e.g., 400 Bad Request)
                        return response.json().then(errorData => {
                            showMessageBox(`Signup failed: ${errorData.message || 'Server error'}`, 'red');
                        }).catch(() => {
                            showMessageBox('Signup failed: Server returned non-JSON error.', 'red');
                        });
                    }
                })
                .catch(error => {
                    submitButton.textContent = 'Sign Up';
                    submitButton.disabled = false;
                    console.error('Network or CORS error:', error);
                    showMessageBox('Signup failed: Could not reach the server.', 'red');
                });
        };

        // Attach event listener to the form's submit event
        window.onload = () => {
            document.getElementById('signup-form').addEventListener('submit', handleSignup);
        };
    </script>
</head>
<link rel="stylesheet" href="/extras/css1/register.css">
<body class="flex items-center justify-center min-h-screen p-4 bg-slate-900">

<!-- Custom Message Box -->
<div id="message-box" class="hidden fixed top-4 mx-auto w-full max-w-sm text-center py-3 px-4 rounded-lg text-white font-medium shadow-xl transition-opacity duration-500 opacity-0 z-50">
    <!-- Message will appear here -->
</div>

<!-- The Form Container - Simple, solid, and focused -->
<section id="signup-section"
         class="relative w-full max-w-sm md:max-w-md
               bg-gray-800 text-gray-100 rounded-xl
               p-8 md:p-10 shadow-2xl transition-all duration-500 border border-gray-700">

    <form id="signup-form">

        <h1 class="text-3xl font-bold text-white text-center mb-8">
            Create Account
        </h1>

        <!-- Name Input -->
        <div class="input-group">
            <ion-icon name="person-outline"></ion-icon>
            <input type="text" id="username" name="username" required autocomplete="name" />
            <label for="username">Full Name</label>
        </div>

        <!-- Email Input -->
        <div class="input-group">
            <ion-icon name="mail-outline"></ion-icon>
            <input type="email" id="email" name="email" required autocomplete="email" />
            <label for="email">Email Address</label>
        </div>

        <!-- Password Input -->
        <div class="input-group">
            <ion-icon name="lock-closed-outline"></ion-icon>
            <input type="password" id="password" name="password" required autocomplete="new-password" />
            <label for="password">Password</label>
        </div>

        <!-- Confirm Password Input -->
        <div class="input-group">
            <ion-icon name="lock-closed-outline"></ion-icon>
            <input type="password" id="passwordcon" name="passwordcon" required autocomplete="new-password" />
            <label for="passwordcon">Confirm Password</label>
        </div>

        <!-- Sign Up Button - Functional Blue -->
        <button id="submit" type="submit"
                class="w-full h-12 rounded-lg bg-primary-blue text-white font-bold text-lg mt-4
                           shadow-md hover:bg-primary-blue/90 transition-all duration-300 ease-in-out">
            Sign Up
        </button>

        <!-- Login Link -->
        <div class="text-center text-sm text-gray-300 mt-6">
            <p>Already have an account?
                <a href="login.html" class="font-bold text-primary-blue hover:underline transition-colors duration-300">
                    Log In
                </a>
            </p>
        </div>

    </form>
</section>

</body>
</html>
